#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <fcntl.h>
#include <errno.h>
#include <sys/mman.h>
#include <sys/types.h>

void garnir(char zone[], int lg, char motif) {
	int ind;
	for (ind=0; ind<lg; ind++) {
		zone[ind] = motif ;
	}
}

void lister(char zone[], int lg) {
	int ind;
	for (ind=0; ind<lg; ind++) {
		printf("%c",zone[ind]);
	}
	printf("\n");
}

int main(int argc,char *argv[]) {
	int taillepage = sysconf(_SC_PAGESIZE);
	int fd=open("Temporaire",O_CREAT|O_TRUNC|O_WRONLY);
	/**Couplage du segment de taille 2 pages au fichier en mode partageable*/
    char *buf=mmap(fd,2*taillepage,PROT_READ|PROT_WRITE,MAP_ANON|MAP_SHARED,-1,0);
	garnir(buf,taillepage, 'a');
	
	if (fd < 0) {
        printf("Erreur ouverture") ;
    exit(1) ;
     }
	
	write(fd,buf,taillepage);
	close(fd);
	
	
	/**Creer un processus fils*/
	if(!fork()){
		sleep(2);
		/**Lister les 10 premiers octets de chaque page*/
		lister(buf,10);
		lister(buf+taillepage,10);
		/**Remplir la première page avec 'c'*/
		garnir(buf,taillepage,'c');
        exit(0);
	}
/**Pere*/
garnir(buf+taillepage,taillepage,'b');
/**Attendre la fin du fils*/
int status;
wait(&status);
/**Lister les 10 premiers octets de la 1ère page*/
lister(buf,10);

}
